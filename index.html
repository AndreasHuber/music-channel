<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMC - Andreas' Music Channel</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
        }

        #cover-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: black;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            cursor: pointer;
        }

        #on-switch {
            font-size: 100px;
            color: white;
        }

        #logo {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 5;
            width: 150px;
            height: auto;
            opacity: 0.8;
        }

        #player-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: none; /* Hide initially */
        }

        #player {
            width: 100%;
            height: 100%;
        }

        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            background-color: transparent;
        }

        #info {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 28px;
            padding: 10px 20px;
            z-index: 5;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #info.visible {
            opacity: 1;
        }

        #info::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background-color: #e8c66c;
            filter: url(#brush-filter);
            z-index: -1;
            transform: rotate(-1deg);
        }

        #info .artist {
            color: #d87465;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="cover-screen" onclick="switchOn()">
        <div id="on-switch">⏻</div>
    </div>
    <img id="logo" src="andreas_music_channel.png" alt="Andreas' Music Channel">
    <div id="player-container">
        <iframe id="player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        <div id="overlay"></div>
    </div>
    <div id="info"></div>
    <svg style="position: absolute; width: 0; height: 0;" xmlns="http://www.w3.org/2000/svg">
        <filter id="brush-filter">
            <feTurbulence type="fractalNoise" baseFrequency="0.04" numOctaves="5" seed="1" />
            <feDisplacementMap in="SourceGraphic" scale="20" />
            <feMorphology operator="dilate" radius="2" />
            <feGaussianBlur stdDeviation="2" />
        </filter>
    </svg>
    <div id="duration-player" style="display: none;"></div>
    <script>
        const videoIds = [
            'iwTch-Kon38',
            '4yNxUYIEkuA',
        ];

        let currentVideoIndex = -1;
        let nextVideoIndex = getRandomVideoIndex();
        const player = document.getElementById('player');
        const playerContainer = document.getElementById('player-container');
        let videoTimer;
        let durationPlayer;

        function onYouTubeIframeAPIReady() {
            durationPlayer = new YT.Player('duration-player', {
                height: '1',
                width: '1',
                videoId: videoIds[0],
                playerVars: {'autoplay': 0, 'controls': 0},
                events: {'onReady': onDurationPlayerReady}
            });
        }

        function onDurationPlayerReady(event) {
            // Duration player is ready
        }

        function switchOn() {
            document.getElementById('cover-screen').style.display = 'none';
            playerContainer.style.display = 'block';
            playRandomVideo();
        }

        function getRandomVideoIndex() {
            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * videoIds.length);
            } while (randomIndex === currentVideoIndex);
            return randomIndex;
        }

        function playRandomVideo() {
            currentVideoIndex = nextVideoIndex;
            nextVideoIndex = getRandomVideoIndex();
            
            player.src = `https://www.youtube.com/embed/${videoIds[currentVideoIndex]}?autoplay=1&controls=0&showinfo=0&modestbranding=1&rel=0&fs=0&cc_load_policy=0&iv_load_policy=3&autohide=1&start=23&enablejsapi=1&origin=${window.location.origin}`;
            
            getVideoDuration(videoIds[currentVideoIndex])
                .then(duration => {
                    displayVideoInfo();
                    
                    // Set up next video
                    clearTimeout(videoTimer);
                    videoTimer = setTimeout(playRandomVideo, duration * 1000);
                })
                .catch(error => {
                    console.error('Error getting video duration:', error);
                    // If there's an error, use a default duration of 5 minutes
                    clearTimeout(videoTimer);
                    videoTimer = setTimeout(playRandomVideo, 300000);
                });
        }

        function getVideoDuration(videoId) {
            return new Promise((resolve, reject) => {
                durationPlayer.loadVideoById(videoId);
                let checkDuration = setInterval(() => {
                    let duration = durationPlayer.getDuration();
                    if (duration > 0) {
                        clearInterval(checkDuration);
                        durationPlayer.stopVideo();
                        resolve(duration);
                    }
                }, 100);
                
                // Timeout after 5 seconds
                setTimeout(() => {
                    clearInterval(checkDuration);
                    reject('Timeout getting video duration');
                }, 5000);
            });
        }

        function displayVideoInfo() {
            fetch(`https://noembed.com/embed?url=https://www.youtube.com/watch?v=${videoIds[currentVideoIndex]}`)
                .then(response => response.json())
                .then(data => {
                    const title = data.title;
                    const artistAndSong = title.split(/ - | – /);
                    const artist = artistAndSong[0];
                    const song = artistAndSong[1] ? artistAndSong[1].split(/[\(\[\{]/)[0].trim() : 'Unknown';

                    const infoElement = document.getElementById('info');
                    infoElement.innerHTML = `<span class="artist">${artist}</span> - ${song}`;
                    infoElement.classList.add('visible');

                    setTimeout(() => {
                        infoElement.classList.remove('visible');
                    }, 5000);
                });
        }

        window.addEventListener('keydown', function(e) {
            if (e.keyCode === 13) {
                switchOn();
            }
        });
    </script>
    <script src="https://www.youtube.com/iframe_api"></script>
</body>
</html>